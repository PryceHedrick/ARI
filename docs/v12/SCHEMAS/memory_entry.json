{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://ari.local/schemas/memory_entry.json",
  "title": "ARI Memory Entry Schema",
  "description": "Schema for memory entries with provenance tracking and poisoning defense",
  "version": "12.0.0",
  
  "type": "object",
  "required": [
    "id",
    "type",
    "partition",
    "content",
    "source",
    "confidence",
    "sensitivity",
    "created_at",
    "hash"
  ],
  
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this memory entry"
    },
    
    "type": {
      "type": "string",
      "enum": ["FACT", "PREFERENCE", "PROCEDURE", "EVENT", "CONTEXT"],
      "description": "Type of memory content"
    },
    
    "partition": {
      "type": "string",
      "pattern": "^(KERNEL|OPS|PERSONAL|VENTURE_[a-z_]+|LIFE_[a-z_]+)$",
      "description": "Memory partition for isolation"
    },
    
    "content": {
      "type": "string",
      "maxLength": 65536,
      "description": "The actual memory content"
    },
    
    "source": {
      "type": "object",
      "required": ["origin", "timestamp"],
      "properties": {
        "origin": {
          "type": "string",
          "enum": ["OPERATOR", "SYSTEM", "AGENT", "EXTERNAL"],
          "description": "Trust level of source"
        },
        "agent": {
          "type": "string",
          "description": "Agent that created this memory"
        },
        "request_id": {
          "type": "string",
          "format": "uuid",
          "description": "Linked request ID for traceability"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "When the source data was received"
        },
        "external_source": {
          "type": "string",
          "description": "For EXTERNAL origin, the specific source (URL, email, etc.)"
        }
      }
    },
    
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence level in the memory accuracy"
    },
    
    "sensitivity": {
      "type": "string",
      "enum": ["PUBLIC", "INTERNAL", "SENSITIVE"],
      "description": "Sensitivity classification"
    },
    
    "access_control": {
      "type": "object",
      "properties": {
        "read": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Agents with read access"
        },
        "write": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Agents with write access"
        },
        "admin": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Agents with admin access"
        }
      },
      "default": {
        "read": ["*"],
        "write": [],
        "admin": []
      }
    },
    
    "created_at": {
      "type": "string",
      "format": "date-time",
      "description": "When this memory was created"
    },
    
    "updated_at": {
      "type": "string",
      "format": "date-time",
      "description": "When this memory was last updated"
    },
    
    "expires_at": {
      "type": ["string", "null"],
      "format": "date-time",
      "description": "When this memory expires (null = no expiry)"
    },
    
    "approved_by": {
      "type": "string",
      "enum": ["operator", "overseer", "auto", "system"],
      "description": "Who approved this memory write"
    },
    
    "hash": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$",
      "description": "SHA256 hash of content for integrity verification"
    },
    
    "version": {
      "type": "integer",
      "minimum": 1,
      "description": "Version number for this memory"
    },
    
    "previous_version": {
      "type": ["string", "null"],
      "format": "uuid",
      "description": "ID of previous version (null if first version)"
    },
    
    "quarantine_status": {
      "type": "string",
      "enum": ["NONE", "PENDING", "APPROVED", "REJECTED"],
      "default": "NONE",
      "description": "Quarantine status for untrusted sources"
    },
    
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Optional tags for categorization"
    },
    
    "metadata": {
      "type": "object",
      "description": "Additional metadata as needed"
    }
  },
  
  "additionalProperties": false,
  
  "examples": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "type": "FACT",
      "partition": "PERSONAL",
      "content": "Operator prefers direct communication style",
      "source": {
        "origin": "OPERATOR",
        "agent": "Router",
        "request_id": "660e8400-e29b-41d4-a716-446655440001",
        "timestamp": "2026-01-26T10:00:00Z"
      },
      "confidence": 1.0,
      "sensitivity": "INTERNAL",
      "access_control": {
        "read": ["*"],
        "write": ["Memory_Manager"],
        "admin": ["Arbiter"]
      },
      "created_at": "2026-01-26T10:00:00Z",
      "updated_at": "2026-01-26T10:00:00Z",
      "expires_at": null,
      "approved_by": "auto",
      "hash": "a1b2c3d4e5f6789012345678901234567890123456789012345678901234abcd",
      "version": 1,
      "previous_version": null,
      "quarantine_status": "NONE",
      "tags": ["preference", "communication"],
      "metadata": {}
    }
  ]
}
